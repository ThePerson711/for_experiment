<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PlayStation Joystick</title>
<style>
    .joystick {
  width: 200px;
  height: 200px;
  background: #000;
  border-radius: 50%;
  position: relative;
  overflow: hidden;
}

.stick {
  width: 50px;
  height: 50px;
  background: #fff;
  border-radius: 50%;
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
}

.stick::before {
  content: "";
  width: 10px;
  height: 10px;
  background: #000;
  border-radius: 50%;
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
}

.stick::after {
  content: "";
  width: 100%;
  height: 2px;
  background: #000;
  position: absolute;
  top: 50%;
  left: 0;
}
.par {
  color: red;
  left: 100px;
  font-size: 16px;
  border: solid 4px blue;
}

</style>
</head>
<body>
  <div class="container">
    <div class="joystick">
      <div class="stick" id="stick1"></div>
      <p class="par" id="direction1">Direction: Center</p>
    </div>
    <div class="joystick">
      <div class="stick" id="stick2"></div>
      <p class="par" id="direction2">Direction: Center</p>
    </div>
  </div>
  <p id="x_">x:</p>
  <p id="y_">y:</p>
<script>

var stick1 = document.getElementById('stick1');
var stick2 = document.getElementById('stick2');

var direction1 = document.getElementById('direction1');
var direction2 = document.getElementById('direction2');

stick1.addEventListener('touchstart', handleTouchStart.bind(null, stick1, direction1), false);
stick1.addEventListener('touchmove', handleTouchMove.bind(null, stick1, direction1), false);
stick1.addEventListener('touchend', handleTouchEnd.bind(null, stick1, direction1), false);

stick2.addEventListener('touchstart', handleTouchStart.bind(null, stick2, direction2), false);
stick2.addEventListener('touchmove', handleTouchMove.bind(null, stick2, direction2), false);
stick2.addEventListener('touchend', handleTouchEnd.bind(null, stick2, direction2), false);

var initialX = {};
var initialY = {};

function handleTouchStart(stick, direction, evt) {
    initialX[stick.id] = evt.touches[0].clientX - stick.offsetLeft;
    initialY[stick.id] = evt.touches[0].clientY - stick.offsetTop;
   // direction.innerHTML = "Touch";
}

function handleTouchMove(stick, direction, evt) {
    if (initialX[stick.id] === undefined || initialY[stick.id] === undefined) {
        return;
    }

    var newX = evt.touches[0].clientX - initialX[stick.id];
    var newY = evt.touches[0].clientY - initialY[stick.id];

    var boundingRect = stick.parentElement.getBoundingClientRect();
    var maxX = boundingRect.width;// - stick.offsetWidth;
    var maxY = boundingRect.height;// - stick.offsetHeight;

    newX = Math.max(0, Math.min(newX, maxX));
    newY = Math.max(0, Math.min(newY, maxY));

    stick.style.left = newX + 'px';
    stick.style.top = newY + 'px';

    document.getElementById("x_").innerHTML = newX;
    document.getElementById("y_").innerHTML = newY;

    var deltaX = newX - stick.offsetLeft;
    var deltaY = newY - stick.offsetTop;

    if (newY < maxY/2 && 
      ((newX <= maxX/2 && newX/newY < 1) || (newX > maxX/2 && (maxX/2-newX)/newY < 1))) {
      direction.innerHTML = "Direction: UP";
    } 
    //
    if (newY > maxY/2 && 
      ((newX <= maxX/2 && newX/newY < 1) || (newX > maxX/2 && (maxX/2-newX)/newY < 1))) {
      direction.innerHTML = "Direction: Down";
    } 
    //
    //if (newX < maxX/2 && 
    //  ((newY <= maxY/2 && newY/newX < 1) || (newY > maxY/2 && (maxY/2-newX)/newY < 1))) {
    //  direction.innerHTML = "Direction: LEFT";
    //} 
    //
    //if (newX > maxX/2 && 
    //  ((newY <= maxY/2 && newY/newX < 1) || (newY > maxY/2 && (maxY/2-newX)/newY < 1))) {
    //  direction.innerHTML = "Direction: RIGHT";
    //} 

    /*if (deltaX < -5) {
        direction.innerHTML = "Direction: Left";
    } else if (deltaX > 5) {
        direction.innerHTML = "Direction: Right";
    } else if (deltaY < -5) {
        direction.innerHTML = "Direction: Up";
    } else if (deltaY > 5) {
        direction.innerHTML = "Direction: Down";
    }*/

    evt.preventDefault();
}

function handleTouchEnd(stick, direction) {
    initialX[stick.id] = undefined;
    initialY[stick.id] = undefined;
    stick.style.left = '50%';
    stick.style.top = '50%';
    direction.innerHTML = "Direction: Center";
}



</script>
</body>
</html>
